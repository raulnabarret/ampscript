<style type="text/css">
	h1, h2 {
		text-transform: uppercase;
	}

	.wrapper {
		display: flex;
	    height: 100%;
	}

	.image-wrapper {
		display: flex;
	    flex-direction: column;
	    justify-content: space-around;
	    width: 50%;
	    height: 100%;
	}

	img {
		margin: 0 auto;
	}

	.content-wrapper {
		font-family: 'Arial';
	    width: 50%;
	    background: #9bcace;
	    padding: 1em;
	}

	.input-wrapper {
	    display: flex;
	    flex-direction: column;
	    width: 33%;
	}

	.checkbox-wrapper {
	    display: flex;
	    flex-direction: row;
	    width: 40%;
	}

	.button-wrapper {
		margin-top: 0.5em;
	}

	button {
		cursor: pointer;
		background: #077a86;
	    color: #fff;
	    padding: 0.5em;
	    min-width: 150px;
	    border-radius: 0;
	    border: none;
	}
</style>
<div class="wrapper">
	<div class="content-wrapper">
	%%[	
		SET @Random = RANDOM(100, 999)
		SET @EmailAddress = 'raulnabarret@gmail.com'


		SET @rrObj = CreateObject("RetrieveRequest") 

		SetObjectProperty(@rrObj, "ObjectType", "Subscriber")
		AddObjectArrayItem(@rrObj,"Properties","SubscriberKey")

		SET @cObj = CreateObject("SimpleFilterPart")
		SetObjectProperty(@cObj, "Property", "SubscriberKey")
		SetObjectProperty(@cObj, "SimpleOperator", "equals")
		AddObjectArrayItem(@cObj, "Value",@EmailAddress)

		SetObjectProperty(@rrObj, "Filter", @cObj)

		SET @ResultSet = InvokeRetrieve(@rrObj)

		IF(Rowcount(@ResultSet)>0) THEN       
		    SET @row = row(@ResultSet,1)        
		    SET @Status = Field(@row,"Status")
		ENDIF

	    SET @ListID = "12608"
	    SET @SubscriberKey = @EmailAddress
	 
	    SET @rr = CreateObject("RetrieveRequest")
	    SetObjectProperty(@rr,"ObjectType","ListSubscriber")
	    AddObjectArrayItem(@rr,"Properties","SubscriberKey")
	    AddObjectArrayItem(@rr,"Properties","ListID")
	    
	    SET @sfpl = CreateObject("SimpleFilterPart")
	    SetObjectProperty(@sfpl,"Property","ListID")
	    SetObjectProperty(@sfpl,"SimpleOperator","equals")
	    AddObjectArrayItem(@sfpl,"Value",@ListID)
	 
	    SET @sfpr = CreateObject("SimpleFilterPart")
	    SetObjectProperty(@sfpr,"Property","SubscriberKey")
	    SetObjectProperty(@sfpr,"SimpleOperator","equals")
	    AddObjectArrayItem(@sfpr,"Value",@SubscriberKey)
	 
	    SET @cf = CreateObject("ComplexFilterPart")
	    SetObjectProperty(@cf,"LeftOperand",@sfpl)
	    SetObjectProperty(@cf,"RightOperand",@sfpr)
	    SetObjectProperty(@cf,"LogicalOperator","AND")
	 
	    SetObjectProperty(@rr,"Filter",@cf)

		SET @listFields = InvokeRetrieve(@rr)
	    for @i = 1 to RowCount(@listFields) do

		  set @dataExtensionField = Row(@listFields, @i)
		  set @Status = Field(@dataExtensionField, "Status")
		  set @EmailAddress = Field(@dataExtensionField, "Email Address")

		  output(concat("<br>Status: ", @Status))
		  output(concat("<br>EmailAddress: ", @EmailAddress))

		next @i

	]%%
		<div>
			<h1>Email Preference Center</h1>
		</div>
		<div>
			<div>
				<h2>Update Your Email Address</h2>	
			</div>
			<div class="input-wrapper">
				<label>Email Address</label>
				<input type="email" name="email" value="%%=v(@EmailAddress)=%%">
			</div>
			<div class="button-wrapper">
				<button>Update</button>
			</div>
		</div>
		<div>
			<div>
				<h2>Newsletters</h2>	
			</div>
			<div>
				<form>
					<div class="checkbox-wrapper">
						<input type="checkbox" name="quarterlyNewsletters" id="quarterlyNewsletters">
						<label for="quarterlyNewsletters">Quarterly Newsletters</label>
					</div>
					<div class="button-wrapper">
						<button onclick="handleSubmitPreferences()">Save Preferences</button>
					</div>
				</form>
			</div>
		</div>	
	</div>
	<div class="image-wrapper">
		<img src="https://image.s12.sfmc-content.com/lib/fe28117371640475771d78/m/1/b3f98663-541a-4193-aeef-532127ba111d.png" />
		<img src="https://image.s12.sfmc-content.com/lib/fe28117371640475771d78/m/1/440d1024-6fac-43bd-ae2c-b92e6d51b3cb.png" />
	</div>
</div>	
<script type="text/javascript">
	function handleSubmitPreferences() {
		var quarterlyNewsletters = document.querySelector('#quarterlyNewsletters').checked;
		console.log(quarterlyNewsletters);
		%%[
		 
		    IF RequestParameter('quarterlyNewsletters') == 'on' THEN
		        SET @sub = CreateObject("Subscriber")
		        SetObjectProperty(@sub,"SubscriberKey",@SubscriberKey)
		        set @lSub = CreateObject("SubscriberList")
		        SetObjectProperty(@lSub,"ID",@ListID)
		        SetObjectProperty(@lSub,"Status","Active")
	    		AddObjectArrayItem(@sub,"Lists",@lSub)
	        ELSE
		        SET @sub = CreateObject("Subscriber")
		        SetObjectProperty(@sub,"SubscriberKey",@SubscriberKey)
		        set @lSub = CreateObject("SubscriberList")
		        SetObjectProperty(@lSub,"ID",@ListID)
	        	SetObjectProperty(@lSub,"Status","Unsubscribed")
	    		AddObjectArrayItem(@sub,"Lists",@lSub)	        
        	ENDIF
		        
			SET @updateStatus = InvokeUpdate(@sub)

		]%%
	}
</script>

