<style type="text/css">
	h1, h2 {
		text-transform: uppercase;
		margin: 0;
	}

	.header-wrapper {
		margin-bottom: 0.5em;
	}

	.subheader-wrapper {
		margin-bottom: 0.25em;
	}

	.wrapper {
		display: flex;
	    height: 100%;
	}

	.image-wrapper {
		display: flex;
	    flex-direction: column;
	    justify-content: space-around;
	    width: 50%;
	    height: 100%;
	}

	img {
		margin: 0 auto;
	}

	.content-wrapper {
		font-family: 'Arial';
	    width: 50%;
	    background: #9bcace;
	    padding: 1em;
	}

	.section-wrapper {
	    margin-top: 1em;
	    border-bottom: 1px solid #666;
	    padding-bottom: 1em;
	}

	.input-wrapper {
	    display: flex;
	    flex-direction: column;
	    width: 33%;
	    padding-left: 0.5em;
	}

	.checkbox-wrapper {
	    display: flex;
	    flex-direction: row;
	    padding-left: 0.5em;
	}

	.button-wrapper {
		margin-top: 0.5em;
		padding-left: 0.5em;
	}

	button {
		cursor: pointer;
		background: #077a86;
	    color: #fff;
	    padding: 0.5em;
	    min-width: 150px;
	    border-radius: 0;
	    border: none;
	}
</style>
<script type="text/javascript">
		%%[	
		SET @Random = RANDOM(100, 999)
		SET @EmailAddress = 'raulnabarret@gmail.com'


		SET @rrObj = CreateObject("RetrieveRequest") 

		SetObjectProperty(@rrObj, "ObjectType", "Subscriber")
		AddObjectArrayItem(@rrObj,"Properties","SubscriberKey")

		SET @cObj = CreateObject("SimpleFilterPart")
		SetObjectProperty(@cObj, "Property", "SubscriberKey")
		SetObjectProperty(@cObj, "SimpleOperator", "equals")
		AddObjectArrayItem(@cObj, "Value",@EmailAddress)

		SetObjectProperty(@rrObj, "Filter", @cObj)

		SET @ResultSet = InvokeRetrieve(@rrObj)

		IF(Rowcount(@ResultSet)>0) THEN       
		    SET @row = row(@ResultSet,1)        
		    SET @Status = Field(@row,"Status")
		ENDIF

	    SET @ListID = "12608"
	    SET @SubscriberKey = @EmailAddress
	 
	    SET @rr = CreateObject("RetrieveRequest")
	    SetObjectProperty(@rr,"ObjectType","ListSubscriber")
	    AddObjectArrayItem(@rr,"Properties","SubscriberKey")
	    AddObjectArrayItem(@rr,"Properties","ListID")
	    
	    SET @sfpl = CreateObject("SimpleFilterPart")
	    SetObjectProperty(@sfpl,"Property","ListID")
	    SetObjectProperty(@sfpl,"SimpleOperator","equals")
	    AddObjectArrayItem(@sfpl,"Value",@ListID)
	 
	    SET @sfpr = CreateObject("SimpleFilterPart")
	    SetObjectProperty(@sfpr,"Property","SubscriberKey")
	    SetObjectProperty(@sfpr,"SimpleOperator","equals")
	    AddObjectArrayItem(@sfpr,"Value",@SubscriberKey)
	 
	    SET @cf = CreateObject("ComplexFilterPart")
	    SetObjectProperty(@cf,"LeftOperand",@sfpl)
	    SetObjectProperty(@cf,"RightOperand",@sfpr)
	    SetObjectProperty(@cf,"LogicalOperator","AND")
	 
	    SetObjectProperty(@rr,"Filter",@cf)

	]%%
</script>
<div class="wrapper">
	<div class="content-wrapper">
		<div class="header-wrapper">
			<h1>Email Preference Center</h1>
		</div>
		<div class="section-wrapper">
			<div class="subheader-wrapper">
				<h2>Update Your Email Address</h2>	
			</div>
			<div class="input-wrapper">
				<label>Email Address</label>
				<input type="email" name="email" value="%%=v(@EmailAddress)=%%">
			</div>
			<div class="button-wrapper">
				<button>Update</button>
			</div>
		</div>
		<form>
			<div class="section-wrapper">
				<div class="subheader-wrapper">
					<h2>Newsletters</h2>	
				</div>
				<div>
					<div class="checkbox-wrapper">
						<input type="checkbox" name="quarterlyNewsletters" id="quarterlyNewsletters">
						<label for="quarterlyNewsletters">Quarterly Newsletters</label>
					</div>
				</div>
			</div>	
			<div class="section-wrapper">
				<div>
					<h2 class="subheader-wrapper">Programs</h2>	
				</div>
				<div>
					<div class="checkbox-wrapper">
						<input type="checkbox" name="cdcAdvancedHIVDisease" id="cdcAdvancedHIVDisease">
						<label for="cdcAdvancedHIVDisease">CDC Advanced HIV Disease</label>
					</div>
				</div>
			</div>				
			<div class="section-wrapper">
				<div class="checkbox-wrapper">
					<input type="checkbox" name="allSubscriptions" id="allSubscriptions">
					<label for="allSubscriptions">Unsubscribe from all email communications</label>
				</div>
			</div>
			<div class="button-wrapper">
				<button onclick="handleSubmitPreferences()">Save Preferences</button>
			</div>
		</form>
	</div>
	<div class="image-wrapper">
		<img src="https://image.s12.sfmc-content.com/lib/fe28117371640475771d78/m/1/b3f98663-541a-4193-aeef-532127ba111d.png" />
		<img src="https://image.s12.sfmc-content.com/lib/fe28117371640475771d78/m/1/440d1024-6fac-43bd-ae2c-b92e6d51b3cb.png" />
	</div>
</div>	
<script type="text/javascript">
	function handleSubmitPreferences() {
		//var quarterlyNewsletters = document.querySelector('#quarterlyNewsletters').checked;
		%%[
		 
		    IF RequestParameter('quarterlyNewsletters') == 'on' THEN
		        SET @sub = CreateObject("Subscriber")
		        SetObjectProperty(@sub,"SubscriberKey",@SubscriberKey)
		        set @lSub = CreateObject("SubscriberList")
		        SetObjectProperty(@lSub,"ID",@ListID)
		        SetObjectProperty(@lSub,"Status","Active")
	    		AddObjectArrayItem(@sub,"Lists",@lSub)
	        ELSE
		        SET @sub = CreateObject("Subscriber")
		        SetObjectProperty(@sub,"SubscriberKey",@SubscriberKey)
		        set @lSub = CreateObject("SubscriberList")
		        SetObjectProperty(@lSub,"ID",@ListID)
	        	SetObjectProperty(@lSub,"Status","Unsubscribed")
	    		AddObjectArrayItem(@sub,"Lists",@lSub)	        
        	ENDIF
			SET @updateStatus = InvokeUpdate(@sub)

			//All subscriptions
        	IF RequestParameter('allSubscriptions') == 'on'
	    		SET @Status = 'Active'    
    		ELSE	
	    		SET @Status = 'Unsubscribed'    
			ENDIF
		    SET @sub2 = CreateObject("Subscriber")
		    SetObjectProperty(@sub2,"EmailAddress", @EmailAddress)
		    SetObjectProperty(@sub2,"SubscriberKey", @SubscriberKey)
		    SetObjectProperty(@sub2,"Status",@Status)
		    SET @options = CreateObject("UpdateOptions")
		    SET @save = CreateObject("SaveOption")
		    SetObjectProperty(@save,"SaveAction","UpdateAdd")
		    SetObjectProperty(@save,"PropertyName","*")
		    AddObjectArrayItem(@options,"SaveOptions", @save)
		    SET @update_sub = InvokeUpdate(@sub2, @update_sub_status, @update_sub_errorcode, @options)		        
		]%%
	}
</script>

